我们清楚了mingw64(gcc)的工作原理以及指令了之后, 可不可以通过vscode任务tasks.json提前配置好编译命令方便我们一键编译?

答案是可以的, 这样免去了每次手动输入编译命令

同时通过vscode提前配置好调试功能launch.json, 以及代码智能提示与跳转c_cpp_properties.json

上述三个配置文件tasks.json, launch.json, c_cpp_properties.json均放置当前工程目录.vscode
## 安装插件
微软插件c/c++

## tasks.json预编译任务
有了插件之后, cpp文件右上角会显示可执行gutter, 点击就会生成tasks.json默认模板, 你也可以手动新建

tasks.json文件配置内容如下。在配置路径时只能使用\\或/隔开目录。
```
{
    "tasks": [
        {
            "type": "cppbuild",
            "label": "C/C++: g++.exe build",
            "command": "C:\\Users\\hasee\\.mingw\\x86_64-15.2.0-release-win32-seh-ucrt-rt_v13-rev0\\mingw64\\bin\\g++.exe",
            "args": [
                "-fdiagnostics-color=always",
                "-g",
                // "${file}",
                "${fileDirname}\\*.cpp",
                "-o",
                "${fileDirname}\\..\\build\\${fileBasenameNoExtension}.exe"
            ],
            "options": {
                // 设置工作目录（Current Working Directory）
				// 编译器将在此目录下查找相对路径文件（如 #include "xxx"）
				// 最好设为项目根目录，否则头文件路径会解析错误
                "cwd": "${workspaceFolder}",
                // "cwd": "${fileDirname}"
            },
            "problemMatcher": [
                "$gcc"
            ],
            "group": {
                "kind": "build",
                "isDefault": false
            },
            "detail": "调试器生成的任务。"
        },
    ],
    "version": "2.0.0"
}
```
下面对tasks.json文件中的参数进行介绍：
- "type"：任务类型，可以取cppbuild、shell、process，三种执行时稍有差异，这里选择默认cppbuild。
- "label"：任务名称，对应的值可以更改。tasks.json文件中label对应的值要和launch.json里面"preLaunchTask"对应的值一致。
- "command"：编译器及其路径。.c用gcc.exe编译器(C语言编译器)，.cpp用g++.exe编译器(C++语言编译器)，还可以是Cmake、make。
- "args"：方括号里面是传给gcc命令或g++命令的一系列参数，用于实现某些功能。
```
"-g"：生成和调试有关的信息，launch.json会用到这些信息。如果少了这个"-g"，生成的可执行文件就不能被调试了。

"${file}"：编译当前打开的.c(或.cpp)文件，此处是hello.c文件。

"${fileDirname}\\*.c", 批量编译当前打开文件所在目录下的所有c文件

"${fileDirname}\\*.cpp", 批量编译当前打开文件所在目录下的所有cpp文件

“-o”：指定编译的输出，windows系统下输出.exe文件。

"${fileDirname}\\${fileBasenameNoExtension}.exe"：表示在当前工作目录下生成一个与源代码同名的可执行文件。

如果将${fileDirname}修改为${workspaceFolder}，那么就会在当前工作区code文件夹下生成一个${fileBasenameNoExtension}.exe文件。
```

我的工程实践是创建src文件夹, 用于存放cpp源文件

然后平行创建build文件夹，用于存放编译链接后的可执行文件exe
```
.vscode
build
src
```

接着将编译后输出的可执行文件路径设置为：`"${fileDirname}\\..\\build\\${fileBasenameNoExtension}.exe"`。

同时需要将launch.json文件中的参数"program"同样设置为：`"${fileDirname}\\..\\build\\${fileBasenameNoExtension}.exe"`。

那么后续launch.json就能精准调试执行到tasks.json编译链接后的可执行文件

## launch.json调试执行
我的launch.json配置如下, 指定GDB或者LLDB是作为C/C++的调试器(debugger)

```
{
    // Use IntelliSense to learn about possible attributes.
    // Hover to view descriptions of existing attributes.
    // For more information, visit: https://go.microsoft.com/fwlink/?linkid=830387
    "version": "0.2.0",
    "configurations": [  {
            "name": "C/C++: gcc.exe build and debug",
            "type": "cppdbg",
            "request": "launch",
            "program": "${fileDirname}\\..\\build\\${fileBasenameNoExtension}.exe",
            "args": [],
            "stopAtEntry": false,
            // "cwd": "C:\\Users\\hasee\\.mingw\\x86_64-15.2.0-release-win32-seh-ucrt-rt_v13-rev0\\mingw64\\bin",
            "cwd": "${fileDirname}",
            // "cwd": "${workspaceFolder}",
            "environment": [],
            "externalConsole": false,
            "MIMode": "gdb",
            "miDebuggerPath": "C:\\Users\\hasee\\.mingw\\x86_64-15.2.0-release-win32-seh-ucrt-rt_v13-rev0\\mingw64\\bin\\gdb.exe",
            "setupCommands": [
                {
                    "description": "为 gdb 启用整齐打印",
                    "text": "-enable-pretty-printing",
                    "ignoreFailures": true
                },
                {
                    "description": "将反汇编风格设置为 Intel",
                    "text": "-gdb-set disassembly-flavor intel",
                    "ignoreFailures": true
                }
            ],
            "preLaunchTask": "C/C++: g++.exe build"
        }
    ]
}
```
下面对launch.json文件中的参数进行介绍：
- "name"：自定义命名运行与调式的名称，将在左侧调试菜单中显示名称
- "type"：配置类型，调试器类型，cppdbg为C/C++的调试类型。
- "request"：配置请求类型，可以为launch（启动并调试一个新进程）或attach（附加到一个已在运行的进程）。
- "program"：在windows系统下需要进行调试的可执行文件(.exe文件)及其路径，应当与tasks.json编译后输出的可执行文件(.exe文件)及其路径一致。
- "args"：程序调试时传递给程序的命令行参数，一般设为空即可，这里提到的程序实际就上面的.exe文件。
- "stopAtEntry"：设为true时程序将暂停在程序入口处，一般设置为false。
- "cwd"：当前工作目录(路径)。
- "environment"：添加到程序的环境变量。
- "externalConsole" ：true开启外部控制台窗口，false会使用vscode内部控制台窗口。
- "MIMode"：指示 MIDebugEngine 要连接到的控制台调试程序，允许的值为 "gdb"、"lldb"。这里使用gdb进行调试。
- miDebuggerPath”：调试器debugger文件及其路径，这里是调用mingw64中gdb调试器的路径。
- "preLaunchTask"：运行和调式前要启动的tasks任务，也即要启动的编译任务，任务名要和tasks.json里面的"label"值对应一致。

## 智能提示与代码跳转
c_cpp_properties.json文件主要是对编辑环境的配置，是针对IntelliSense(智能感知)引擎的有关配置。intelliSense是各种代码编辑功能的通用术语，包括：代码补全、参数信息提示、快速信息描述提示和成员列表提示等，因而，intelliSense也称为代码提示(code hinting)。

当我们装了C/C++编译器，并在vs code中安装了具有调试功能的C/C++扩展(Extension)后，会自动产生默认的c_cpp_properties.json配置。上面tasks.json、launch.json文件配置完后，我们就能运行C/C++程序了，此时采用默认的c_cpp_properties.json配置。一般情况下，我们可以不用配置.

**但如果我们要指定头文件(.h文件)、库的位置，那么就需要配置c_cpp_properties.json、tasks.json文件。**

我们可以点击vscode右下角的Win32, 或者通过快捷键Ctrl+Shift+P打开命令面板，接着输入关键词C/C++编辑配置 ，之后会弹出C/C++Configuration(JSON)和C/C++Configuration(UI)两种选项. 这两种选项都是项目级别的配置, 而非用户级, 避免了配置污染

我的配置如下
```
{
    "configurations": [
        {
            "name": "Win32",
            "includePath": [
                "${workspaceFolder}/**"
            ],
            "defines": [
                "_DEBUG",
                "UNICODE",
                "_UNICODE"
            ],
            "compilerPath": "C:\\Users\\hasee\\.mingw\\x86_64-15.2.0-release-win32-seh-ucrt-rt_v13-rev0\\mingw64\\bin\\gcc.exe",
            "cStandard": "c17",
            "cppStandard": "gnu++17",
            "intelliSenseMode": "windows-gcc-x64"
        }
    ],
    "version": 4
}
```

文件中的参数介绍如下：
- "name"：名称。操作系统根据这个名称识别对应的属性配置，windows系统：Win32；Linux系统：Linux；macOS系统：Mac。
- "includePath"：头文件路径。以便IntelliSense(智能感知)引擎的搜索。`"${workspaceFolder}/**"`：当前项目所在根目录并递归搜索子目录，也就是当前工作区文件夹的路径(例如：D:\code)，而且还会递归查找其所有的子目录。
- "defines"：IntelliSense(智能感知)引擎在分析文件时要使用的预处理器定义列表。
- "cStandard"：用于IntelliSense(智能感知)引擎的c标准(版本)。
- "cppStandard"：用于IntelliSense(智能感知)引擎的c++标准(版本)。
- "intelliSenseMode"：IntelliSense(智能感知)的模式。
- "compilerPath"：根据该路径查询编译器(gcc.exe、g++.exe)，以便启用更加准确的IntelliSense(智能感知)。

## 启动调试
选择你自定义的launch.json名: C/C++: gcc.exe build and debug, 运行

你会发现编译链接后的产物main.exe自动生成到了build文件夹

同时控制台打印了日志
```
Hello, from cpp-practice!
Integer a: 10
Double b: 20.5
String c: cpp-practice
sum = 3
```

上述cpp集成运行环境等价于以下指令
```
PS E:\github\cpp-practice\src> g++ .\main.cpp .\sum.cpp .\other.cpp -o ..\build\main.exe
PS E:\github\cpp-practice\src> ..\build\main.exe
Hello, from cpp-practice!
Integer a: 10
Double b: 20.5
String c: cpp-practice
sum = 3
```