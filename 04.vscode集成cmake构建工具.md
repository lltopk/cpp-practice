CMake 是一个跨平台的构建工具，用于管理 C/C++ 项目的构建过程。它通过生成标准的构建文件（如 Makefile 或 Ninja 文件）来简化项目的构建和配置。CMake 的主要优势包括：

跨平台：CMake 可以在不同的操作系统上生成相应的构建文件，确保项目在不同平台上的可移植性。

管理复杂项目：CMake 支持多目录、多目标项目，能够轻松管理大型项目。

集成第三方库：通过 find_package 或 FetchContent，CMake 可以方便地集成第三方库。


## 配置cmake压缩包
下载地址: https://cmake.org/download/
下载版本: cmake-4.2.1-windows-x86_64.zip

解压之后配置环境变量
```
CMAKE_HOME: C:\Users\hasee\.cmake\cmake-4.2.1-windows-x86_64
PATH: %CMAKE_HOME%\bin
```

验证环境配置
```
cmake --version
```

## 安装VSCode插件
- cmake tools: 构建工具cmake的插件, cmake项目初始化向导, 标准工程结构: 

```
my_project/

└── build/
├── src/
│   └── main.cpp
├── CMakeLists.txt
├── CMakePresets.json
```

其中CMakePresets.json是cmake预设文件, 配置如下
```
{
    "version": 8,
    "configurePresets": [
        {
            "name": "gcc15",
            "displayName": "GCC 15.2.0 x86_64-w64-mingw32",
            "description": "正在使用编译器: C = C:\\Users\\hasee\\.mingw\\x86_64-15.2.0-release-win32-seh-ucrt-rt_v13-rev0\\mingw64\\bin\\gcc.exe, CXX = C:\\Users\\hasee\\.mingw\\x86_64-15.2.0-release-win32-seh-ucrt-rt_v13-rev0\\mingw64\\bin\\g++.exe",
            "generator": "MinGW Makefiles",
            "binaryDir": "${sourceDir}/out/build/${presetName}",
            "cacheVariables": {
                "CMAKE_INSTALL_PREFIX": "${sourceDir}/out/install/${presetName}",
                "CMAKE_C_COMPILER": "C:/Users/hasee/.mingw/x86_64-15.2.0-release-win32-seh-ucrt-rt_v13-rev0/mingw64/bin/gcc.exe",
                "CMAKE_CXX_COMPILER": "C:/Users/hasee/.mingw/x86_64-15.2.0-release-win32-seh-ucrt-rt_v13-rev0/mingw64/bin/g++.exe",
                "CMAKE_BUILD_TYPE": "Debug"
            }
        }
    ]
}
```
对CMakePresets.json稍作解释
- "name": 预设文件名称
- "displayName"
- "description"
- "generator": 指定生成器为MinGW Makefiles
- "binaryDir": 指定cmake产出目录
- "cacheVariables": cmake支持指定构建参数
```
## 输出路径前缀
"CMAKE_INSTALL_PREFIX": "${sourceDir}/out/install/${presetName}",
## c编译器路径
"CMAKE_C_COMPILER": "C:/Users/hasee/.mingw/x86_64-15.2.0-release-win32-seh-ucrt-rt_v13-rev0/mingw64/bin/gcc.exe",
## c++编译器路径
"CMAKE_CXX_COMPILER": "C:/Users/hasee/.mingw/x86_64-15.2.0-release-win32-seh-ucrt-rt_v13-rev0/mingw64/bin/g++.exe",
## 设置构建类型为Debug。这会启用调试信息编译
"CMAKE_BUILD_TYPE": "Debug"
```

## vscode集成cmake构建
有了上面的CMakeLists.txt, 按住ctrl+s保存之后, 即可自动执行构建

控制台会输出以下命令, 其中参数正是在预设文件中配置的内容CMakePresets.json
```
[proc] 正在执行命令: C:\Users\hasee\.cmake\cmake-4.2.1-windows-x86_64\bin\cmake.EXE -DCMAKE_INSTALL_PREFIX=E:/github/cpp-practice/out/install/gcc15 -DCMAKE_C_COMPILER=C:/Users/hasee/.mingw/x86_64-15.2.0-release-win32-seh-ucrt-rt_v13-rev0/mingw64/bin/gcc.exe -DCMAKE_CXX_COMPILER=C:/Users/hasee/.mingw/x86_64-15.2.0-release-win32-seh-ucrt-rt_v13-rev0/mingw64/bin/g++.exe -DCMAKE_BUILD_TYPE=Debug -S E:/github/cpp-practice -B E:/github/cpp-practice/out/build/gcc15 -G "MinGW Makefiles"
```

这条CMake命令用于vscode集成cmake执行C++项目的构建, 稍作解释

1. `C:\Users\hasee\.cmake\cmake-4.2.1-windows-x86_64\bin\cmake.EXE` - 这是CMake可执行文件的路径，用于运行CMake工具。

2. `-DCMAKE_INSTALL_PREFIX=E:/github/cpp-practice/out/install/gcc15` - 设置安装目录（install prefix）。编译后的可执行文件、库文件等将被安装到这个目录下。这里设置为项目的`out/install/gcc15`目录。

3. `-DCMAKE_C_COMPILER=C:/Users/hasee/.mingw/x86_64-15.2.0-release-win32-seh-ucrt-rt_v13-rev0/mingw64/bin/gcc.exe` - 指定C语言编译器。CMake将使用这个gcc编译器来编译C代码。

4. `-DCMAKE_CXX_COMPILER=C:/Users/hasee/.mingw/x86_64-15.2.0-release-win32-seh-ucrt-rt_v13-rev0/mingw64/bin/g++.exe` - 指定C++编译器。CMake将使用这个g++编译器来编译C++代码。

5. `-DCMAKE_BUILD_TYPE=Debug` - 设置构建类型为Debug。这会启用调试信息编译，通常用于开发阶段，生成的可执行文件包含调试符号，便于调试。

6. `-S E:/github/cpp-practice` - 指定源代码目录（source directory）。CMake将从这个目录读取CMakeLists.txt文件和其他源文件。

7. `-B E:/github/cpp-practice/out/build/gcc15` - 指定构建目录（build directory）。CMake将在这个目录生成构建文件（如Makefile），编译过程将在此进行。

8. `-G "MinGW Makefiles"` - 指定构建系统生成器（generator）。这里使用MinGW Makefiles生成器，会生成适用于MinGW环境的Makefile文件。

这条命令整体是在配置一个使用MinGW工具链的Debug构建，源代码在`E:/github/cpp-practice`，构建输出在`out/build/gcc15`目录。

## vscode集成cmake生成

点击vscode状态栏的生成gutter(生成所选目标 [[预设中的目标]]), 即可一键在`out/build/gcc15`目录生成可执行文件my_app.exe
```
[main] 正在生成文件夹: E:/github/cpp-practice/out/build/gcc15 
[build] 正在启动生成
[proc] 正在执行命令: C:\Users\hasee\.cmake\cmake-4.2.1-windows-x86_64\bin\cmake.EXE --build E:/github/cpp-practice/out/build/gcc15 --
[build] [100%] Built target my_app
[driver] 生成完毕: 00:00:00.219
[build] 生成已完成，退出代码为 0
```

## vscode集成运行与调试可执行文件
点击vscode状态栏的cmake运行gutter(在终端窗口中启动所选目标: [my_app]), 即可运行可执行文件
```
PS E:\github\cpp-practice\out\build\gcc15> ."E:/github/cpp-practice/out/build/gcc15/my_app.exe"
Hello, from cpp-practice!
Integer a: 10
Double b: 20.5
String c: cpp-practice   
sum = 3
```

点击vscode状态栏的cmake调试gutter(启动所选目标的调试程序: [my_app]), 即可运行可执行文件
```
PS E:\github\cpp-practice>  & 'c:\Users\hasee\.vscode\extensions\ms-vscode.cpptools-1.29.3-win32-x64\debugAdapters\bin\WindowsDebugLauncher.exe' '--stdin=Microsoft-MIEngine-In-ztgbmepv.kgh' '--stdout=Microsoft-MIEngine-Out-45ubfx33.oai' '--stderr=Microsoft-MIEngine-Error-op3425ik.ckw' '--pid=Microsoft-MIEngine-Pid-5tzyuhxf.jyx' '--dbgExe=C:/Users/hasee/.mingw/x86_64-15.2.0-release-win32-seh-ucrt-rt_v13-rev0/mingw64/bin/gdb.exe' '--interpreter=mi' osoft-MIEngine-Error-op3425ik.ckw' '--pid=Microsoft-MIEngine-Pid-5tzyuhxf.jyx' '--dbgExe=C:/Users/hasee/.mingw/x86_64-15.2.0-release-win32-seh-ucrt-rt_v13-rev0/mingw64/bin/gdb.exe' '--interpreter=mi' ;c90766de-4c98-4fbe-b60e-c0046646f0dd
Hello, from cpp-practice!
Integer a: 10
Double b: 20.5
String c: cpp-practice
sum = 3
```